/*! roomer_tpt 2015-09-24*/
function buttonTime(){minutes>=45?(thirtyTime=currentTime.getHours()+1+":30",sixtyTime=currentTime.getHours()+2+":00",milThirtyTime=currentTime.getHours()+1+":30",milSixtyTime=currentTime.getHours()+2+":00",parseInt(thirtyTime)>12&&(thirtyTime=parseInt(thirtyTime)-12+":30"),parseInt(sixtyTime)>12&&(sixtyTime=parseInt(sixtyTime)-12+":00")):minutes>=30&&45>minutes?(thirtyTime=currentTime.getHours()+1+":00",sixtyTime=currentTime.getHours()+1+":30",milThirtyTime=currentTime.getHours()+1+":00",milSixtyTime=currentTime.getHours()+1+":30",parseInt(thirtyTime)>12&&(thirtyTime=parseInt(thirtyTime)-12+":00"),parseInt(sixtyTime)>12&&(sixtyTime=parseInt(sixtyTime)-12+":30")):minutes>=15&&30>minutes?(thirtyTime=currentTime.getHours()+1+":00",sixtyTime=currentTime.getHours()+1+":30",milThirtyTime=currentTime.getHours()+1+":00",milSixtyTime=currentTime.getHours()+1+":30",parseInt(thirtyTime)>12&&(thirtyTime=parseInt(thirtyTime)-12+":00"),parseInt(sixtyTime)>12&&(sixtyTime=parseInt(sixtyTime)-12+":30")):15>minutes&&minutes>=0&&(thirtyTime=currentTime.getHours()+":30",sixtyTime=currentTime.getHours()+1+":00",milThirtyTime=currentTime.getHours()+":30",milSixtyTime=currentTime.getHours()+1+":00",parseInt(thirtyTime)>12&&(thirtyTime=parseInt(thirtyTime)-12+":30"),parseInt(sixtyTime)>12&&(sixtyTime=parseInt(sixtyTime)-12+":00"))}function bookRoomThirty(a){$.ajax({type:"POST",url:"/events",data:postThirtyEvent,success:function(b){confirmationThirtyAlert(a),setTimeout(function(){window.location.reload(!0)},3001)},error:function(a){errorAlert($(this)),location.reload()}})}function bookRoomSixty(a){$.ajax({type:"POST",url:"/events",data:postSixtyEvent,success:function(b){confirmationSixtyAlert(a),setTimeout(function(){window.location.reload(!0)},3001)},error:function(a){errorAlert($(this)),location.reload()}})}function ajaxCall(){$.ajax({type:"GET",url:"/events",success:function(a){return eventData=a.items,console.log("EVENT DATA: "),console.log(eventData),roomLoop(),appendInfo(),eventData},error:function(a,b,c){alert(b+" "+c)}})}function data30Loop(a){reserveThirtyTime=currentTime.getDate()+" "+monthNames[currentTime.getMonth()]+" "+currentTime.getFullYear()+" "+milThirtyTime+":00";for(var b=0;b<eventData.length;b++)if(eventData[b].location==roomArray[a].roomNumber){if(new Date(eventData[b].end.dateTime).getTime()>currentTime.getTime()&&currentTime.getTime()>new Date(eventData[b].start.dateTime).getTime())return console.log(roomArray[a].roomNumber+" flag = false, 1"),roomArray[a].available30=!1;if(currentTime.getTime()<new Date(eventData[b].start.dateTime).getTime()&&new Date(eventData[b].start.dateTime).getTime()<Date.parse(reserveThirtyTime))return console.log(roomArray[a].roomNumber+" flag = false, 2"),roomArray[a].available30=!1;if(currentTime.getTime()<=new Date(eventData[b].start.dateTime).getTime()&&Date.parse(reserveThirtyTime)>=new Date(eventData[b].end.dateTime).getTime())return console.log(roomArray[a].roomNumber+" flag = false, 3"),roomArray[a].available30=!1;if(currentTime.getTime()>=new Date(eventData[b].start.dateTime).getTime()&&Date.parse(reserveThirtyTime)<=new Date(eventData[b].end.dateTime).getTime())return console.log(roomArray[a].roomNumber+" flag = false, 4"),roomArray[a].available30=!1}}function data60Loop(a){reserveSixtyTime=currentTime.getDate()+" "+monthNames[currentTime.getMonth()]+" "+currentTime.getFullYear()+" "+milSixtyTime+":00";for(var b=0;b<eventData.length;b++)if(eventData[b].location==roomArray[a].roomNumber){if(new Date(eventData[b].end.dateTime).getTime()>currentTime.getTime()&&currentTime.getTime()>new Date(eventData[b].start.dateTime).getTime())return roomArray[a].available60=!1;if(currentTime.getTime()<new Date(eventData[b].start.dateTime).getTime()&&new Date(eventData[b].start.dateTime).getTime()<Date.parse(reserveSixtyTime))return roomArray[a].available60=!1;if(currentTime.getTime()<=new Date(eventData[b].start.dateTime).getTime()&&Date.parse(reserveSixtyTime)>=new Date(eventData[b].end.dateTime).getTime())return roomArray[a].available60=!1;if(currentTime.getTime()>=new Date(eventData[b].start.dateTime).getTime()&&Date.parse(reserveSixtyTime)<=new Date(eventData[b].end.dateTime).getTime())return roomArray[a].available60=!1}}function roomLoop(){for(var a=0;a<roomArray.length;a++)data30Loop(a),data60Loop(a)}function customConfirmationAlert(a){var b=document.createElement("div");b.setAttribute("id","confirmationPopUp"),b.setAttribute("class","popUp"),b.innerHTML="<div>Confirmation<div id='popUpYesBox'>"+a+".</div></div>",setTimeout(function(){b.parentNode.removeChild(b)},3e3),document.body.appendChild(b)}function confirmationThirtyAlert(a){customConfirmationAlert("You have booked "+a.attr("id")+" through "+thirtyTime)}function confirmationSixtyAlert(a){customConfirmationAlert("You have booked "+a.attr("id")+" through "+sixtyTime)}function computerIcon(a){return 1==roomArray[a].computer?'<div><img src="/assets/images/computer.svg" class="icon computerStatusIcon" onerror="/assets/images/computer.png"></div>':'<div class="icon noComputerStatusIcon"></div>'}function errorAlert(a){var b=document.createElement("div");b.setAttribute("id","denialPopUp"),b.setAttribute("class","popUp"),b.innerHTML="<div>Sorry! <div id='popUpNoBox'>"+a.parent().attr("id")+" was booked by someone else since you loaded the page.  Please choose a different conference room.</div><button id='confirmDoubleBook'>OK</button></div>",document.body.appendChild(b),$("#theBody").on("click","#confirmDoubleBook",function(){b.parentNode.removeChild(b),location.reload()})}function appendInfo(){buttonTime();for(var a=0;a<roomArray.length;a++){var b="";b=roomArray[a].capacity>9?" digits2":" digits1";var c="";roomArray[a].roomNumber.length>8&&(c=" longRoom"),1==roomArray[a].available30&&$("#rooms").append("<div class='roomBlock' id='"+roomArray[a].roomNumber+"'><div class='roomInfo'><h2 class='room text"+c+"'>"+roomArray[a].roomNumber+"</h2><div class='icons'>"+computerIcon(a)+"<div class='icon theCapacityNum"+b+"'>"+roomArray[a].capacity+"</div></div></div><div class='bookers'><button class='thirty btn btn-book bookerA' id='"+roomArray[a].roomNumber+"'><span class='glyphicon glyphicon-arrow-right' aria-hidden='true'></span>"+thirtyTime+"</button>"+assign60Button(a)+"</div></div></div>")}}function assign60Button(a){return 1==roomArray[a].available60?"<button class='sixty btn btn-book bookerB' id='"+roomArray[a].roomNumber+"'><span class='glyphicon glyphicon-arrow-right' aria-hidden='true'></span>"+sixtyTime+"</button>":"<button class='btn btn-disabled bookerB'>Unavailable</button>"}function autoRefresh(a,b){var c=new Date,d=new Date;(c.getMinutes()>a||c.getMinutes()==a&&c.getSeconds()>b||c.getMinutes()==a&&c.getSeconds()==b)&&d.setDate(c.getDate()+1),d.setMinutes(a),d.setSeconds(b);var e=d.getTime()-c.getTime();setTimeout(function(){window.location.reload(!0)},e)}var currentTime=new Date,monthNames=["Jan","Feb","Mar","Apr","May","June","July","Aug","Sept","Oct","Nov","Dec"],monthNum=currentTime.getMonth()+1,minutes=currentTime.getMinutes(),thirtyTime,sixtyTime,reserveSixtyTime,reserveThirtyTime,eventData,postThirtyEvent,postSixtyEvent,milThirtyTime,milSixtyTime;$(document).ready(function(){buttonTime(),ajaxCall(),autoRefresh(0,0),autoRefresh(15,0),autoRefresh(30,0),autoRefresh(45,0),$("#rooms").on("click",".thirty",function(){var a=$(this),b=$(this).attr("id");postThirtyEvent={summary:"squatter@tpt.org",location:b,start:currentTime.getFullYear()+"-0"+monthNum+"-"+currentTime.getDate()+"T"+currentTime.getHours()+":"+currentTime.getMinutes()+":00-05:00",end:currentTime.getFullYear()+"-0"+monthNum+"-"+currentTime.getDate()+"T"+milThirtyTime+":00-05:00"},bookRoomThirty(a);var c=$("<div style='width:10000px; height: 9999px; margin-left: -5000px; top: 0; z-index: 100; position: absolute; background: lightgray; opacity: 0.5; text-align: center; font-size: large; padding-top: 25%; font-weight: bold;'></div>");$("body").append(c)}),$("#rooms").on("click",".sixty",function(){var a=$(this),b=$(this).attr("id");postSixtyEvent={summary:"squatter@tpt.org",location:b,start:currentTime.getFullYear()+"-0"+monthNum+"-"+currentTime.getDate()+"T"+currentTime.getHours()+":"+currentTime.getMinutes()+":00-05:00",end:currentTime.getFullYear()+"-0"+monthNum+"-"+currentTime.getDate()+"T"+milSixtyTime+":00-05:00"},bookRoomSixty(a);var c=$("<div style='width:10000px; height: 9999px; margin-left: -5000px; top: 0; z-index: 100; position: absolute; background: lightgray; opacity: 0.5; text-align: center; font-size: large; padding-top: 25%; font-weight: bold;'></div>");$("body").append(c)}),$("#rooms").on("click",".computerStatusIcon",function(){var a=$("<div style='width:10000px; height: 9999px; margin-left: -5000px; top: 0; z-index: 100; position: absolute; background: lightgray; opacity: 0.5; text-align: center; font-size: large; padding-top: 25%; font-weight: bold;'></div>");$("body").append(a),errorAlert($(this))})});var roomArray=[{roomNumber:"CR 2161",capacity:10,computer:!0,available30:!0,available60:!0},{roomNumber:"CR 3212",capacity:36,computer:!0,available30:!0,available60:!0},{roomNumber:"CR 3487",capacity:6,computer:!1,available30:!0,available60:!0},{roomNumber:"CR 4112",capacity:6,computer:!1,available30:!0,available60:!0},{roomNumber:"CR 4141",capacity:6,computer:!1,available30:!0,available60:!0},{roomNumber:"CR 4181",capacity:8,computer:!0,available30:!0,available60:!0},{roomNumber:"CR 4211",capacity:8,computer:!1,available30:!0,available60:!0},{roomNumber:"CR 4245",capacity:4,computer:!1,available30:!0,available60:!0},{roomNumber:"CR 4261",capacity:8,computer:!1,available30:!0,available60:!0},{roomNumber:"CR 4312",capacity:8,computer:!1,available30:!0,available60:!0},{roomNumber:"CR 4416",capacity:8,computer:!1,available30:!0,available60:!0},{roomNumber:"CR 4487",capacity:4,computer:!1,available30:!0,available60:!0},{roomNumber:"CR 4541",capacity:12,computer:!0,available30:!0,available60:!0},{roomNumber:"Boardroom",capacity:36,computer:!0,available30:!0,available60:!0},{roomNumber:"Street Space",capacity:20,computer:!0,available30:!0,available60:!0},{roomNumber:"Training Room",capacity:16,computer:!0,available30:!0,available60:!0}];