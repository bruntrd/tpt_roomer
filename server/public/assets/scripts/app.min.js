/*! roomer_tpt 2015-09-22*/
function buttonTime(){minutes>=45?(thirtyTime=currentTime.getHours()+1+":30",sixtyTime=currentTime.getHours()+2+":00",milThirtyTime=currentTime.getHours()+1+":30",milSixtyTime=currentTime.getHours()+2+":00",parseInt(thirtyTime)>12&&(thirtyTime=parseInt(thirtyTime)-12+":30"),parseInt(sixtyTime)>12&&(sixtyTime=parseInt(sixtyTime)-12+":00")):minutes>=30&&45>minutes?(thirtyTime=currentTime.getHours()+1+":00",sixtyTime=currentTime.getHours()+1+":30",milThirtyTime=currentTime.getHours()+1+":00",milSixtyTime=currentTime.getHours()+1+":30",parseInt(thirtyTime)>12&&(thirtyTime=parseInt(thirtyTime)-12+":00"),parseInt(sixtyTime)>12&&(sixtyTime=parseInt(sixtyTime)-12+":30")):minutes>=15&&30>minutes?(thirtyTime=currentTime.getHours()+1+":00",sixtyTime=currentTime.getHours()+1+":30",milThirtyTime=currentTime.getHours()+1+":00",milSixtyTime=currentTime.getHours()+1+":30",parseInt(thirtyTime)>12&&(thirtyTime=parseInt(thirtyTime)-12+":00"),parseInt(sixtyTime)>12&&(sixtyTime=parseInt(sixtyTime)-12+":30")):15>minutes&&minutes>=0&&(thirtyTime=currentTime.getHours()+":30",sixtyTime=currentTime.getHours()+1+":00",milThirtyTime=currentTime.getHours()+":30",milSixtyTime=currentTime.getHours()+1+":00",parseInt(thirtyTime)>12&&(thirtyTime=parseInt(thirtyTime)-12+":30"),parseInt(sixtyTime)>12&&(sixtyTime=parseInt(sixtyTime)-12+":00"))}function bookRoomThirty(){$.ajax({type:"POST",url:"/events",data:postThirtyEvent,success:function(a){console.log(a),ajaxCall()}})}function bookRoomSixty(){$.ajax({type:"POST",url:"/events",data:postSixtyEvent,success:function(a){console.log(a),ajaxCall()}})}function roomConfirmationThirty(){$.ajax({url:s,success:function(a){confirmationThirtyAlert($(this)),location.reload()},error:function(a){errorAlert($(this)),location.reload()}})}function roomConfirmationSixty(){$.ajax({url:skdjf,success:function(a){confirmationSixtyAlert($(this)),location.reload()},error:function(a){errorAlert($(this)),location.reload()}})}function ajaxCall(){$.ajax({type:"GET",url:"/events",success:function(a){return eventData=a.items,console.log(eventData),roomLoop(),appendInfo(),console.log("this is reserver 60 time: "+reserveSixtyTime),console.log("this is reserve 30 time: "+reserveThirtyTime),console.log(roomArray[1].available30),console.log(roomArray[1].available60),eventData},error:function(a,b,c){alert(b+" "+c)}})}function data30Loop(a){reserveThirtyTime=currentTime.getDate()+" "+monthNames[currentTime.getMonth()]+" "+currentTime.getFullYear()+" "+thirtyTime+":00";for(var b=0;b<eventData.length;b++)if(eventData[b].location==roomArray[a].roomNumber)return new Date(eventData[b].end.dateTime).getTime()>currentTime.getTime()&&currentTime.getTime()>new Date(eventData[b].start.dateTime).getTime()?roomArray[a].available30=!1:currentTime.getTime()<new Date(eventData[b].start.dateTime).getTime()&&new Date(eventData[b].start.dateTime).getTime()<Date.parse(reserveThirtyTime)?roomArray[a].available30=!1:currentTime.getTime()<=new Date(eventData[b].start.dateTime).getTime()&&Date.parse(reserveThirtyTime)>=new Date(eventData[b].end.dateTime).getTime()?roomArray[a].available30=!1:currentTime.getTime()>=new Date(eventData[b].start.dateTime).getTime()&&Date.parse(reserveThirtyTime)<=new Date(eventData[b].end.dateTime).getTime()?roomArray[a].available30=!1:roomArray[a].available30=!0}function data60Loop(a){reserveSixtyTime=currentTime.getDate()+" "+monthNames[currentTime.getMonth()]+" "+currentTime.getFullYear()+" "+sixtyTime+":00";for(var b=0;b<eventData.length;b++)if(eventData[b].location==roomArray[a].roomNumber)return new Date(eventData[b].end.dateTime).getTime()>currentTime.getTime()&&currentTime.getTime()>new Date(eventData[b].start.dateTime).getTime()?roomArray[a].available60=!1:currentTime.getTime()<new Date(eventData[b].start.dateTime).getTime()&&new Date(eventData[b].start.dateTime).getTime()<Date.parse(reserveSixtyTime)?roomArray[a].available60=!1:currentTime.getTime()<=new Date(eventData[b].start.dateTime).getTime()&&Date.parse(reserveSixtyTime)>=new Date(eventData[b].end.dateTime).getTime()?roomArray[a].available60=!1:currentTime.getTime()>=new Date(eventData[b].start.dateTime).getTime()&&Date.parse(reserveSixtyTime)<=new Date(eventData[b].end.dateTime).getTime()?roomArray[a].available60=!1:roomArray[a].available60=!0}function roomLoop(){for(var a=0;a<roomArray.length;a++)data30Loop(a),data60Loop(a)}function customConfirmationAlert(a,b){var c=document.createElement("div");c.setAttribute("id","confirmationPopUp"),c.setAttribute("class","popUp"),c.innerHTML="<div>Confirmation<div id='popUpYesBox'>"+a+".</div></div>",document.body.appendChild(c)}function confirmationThirtyAlert(a){customConfirmationAlert("You have booked "+a.parent().attr("id")+" through "+thirtyTime,"4000")}function confirmationSixtyAlert(a){customConfirmationAlert("You have booked "+a.parent().attr("id")+" through "+sixtyTime,"4000")}function computerIcon(a){return 1==roomArray[a].computer?'<img src="/assets/images/computer.png" class="icon computerStatusIcon col-md-4 col-sm-4 col-xs-4">':""}function errorAlert(a){console.log("error fired");var b=document.createElement("div");b.setAttribute("id","denialPopUp"),b.setAttribute("class","popUp"),b.innerHTML="<div>Sorry! <div id='popUpNoBox'>"+a.parent().attr("id")+" was booked by someone else since you loaded the page.  Please choose a different conference room.</div><button id='confirmDoubleBook'>OK</button></div>",document.body.appendChild(b)}function appendInfo(){buttonTime();for(var a=0;a<roomArray.length;a++)1==roomArray[a].available30?$("#rooms").append("<div class='container room30' id='"+roomArray[a].roomNumber+"'><h2 class='room text availYellow'>"+roomArray[a].roomNumber+"</h2><div class='icon theCapacityNum col-md-8 col-sm-8 col-xs-8'>"+roomArray[a].capacity+"</div>"+computerIcon(a)+"<button class='thirty btn btn-book'><span class='glyphicon glyphicon-arrow-right' aria-hidden='true'></span>"+thirtyTime+"</button>"+assign60Button(a)+"</div>"):(console.log(roomArray[a].roomNumber+" "+roomArray[a].available30),console.log(roomArray[a].roomNumber+"not appended"))}function assign60Button(a){return 1==roomArray[a].available60?"<button class='sixty btn btn-book'><span class='glyphicon glyphicon-arrow-right' aria-hidden='true'></span>"+sixtyTime+"</button>":"<button class='btn btn-disabled bookerB'>Unavailable</button>"}function autoRefresh(a,b){var c=new Date,d=new Date;(c.getMinutes()>a||c.getMinutes()==a&&c.getSeconds()>b||c.getMinutes()==a&&c.getSeconds()==b)&&d.setDate(c.getDate()+1),d.setMinutes(a),d.setSeconds(b);var e=d.getTime()-c.getTime();setTimeout(function(){window.location.reload(!0)},e)}var currentTime=new Date,monthNames=["Jan","Feb","Mar","Apr","May","June","July","Aug","Sept","Oct","Nov","Dec"],monthNum=currentTime.getMonth()+1,minutes=currentTime.getMinutes(),thirtyTime,sixtyTime,reserveSixtyTime,reserveThirtyTime,eventData,postThirtyEvent,postSixtyEvent,milThirtyTime,milSixtyTime;$(document).ready(function(){buttonTime(),ajaxCall(),autoRefresh(0,0),autoRefresh(15,0),autoRefresh(30,0),autoRefresh(45,0),console.log(monthNum),$("#rooms").on("click",".thirty",function(){var a=$(this).parent().attr("id");postThirtyEvent={summary:"Squatting",location:a,start:currentTime.getFullYear()+"-0"+monthNum+"-"+currentTime.getDate()+"T"+currentTime.getHours()+":"+currentTime.getMinutes()+":00-05:00",end:currentTime.getFullYear()+"-0"+monthNum+"-"+currentTime.getDate()+"T"+milThirtyTime+":00-05:00"},bookRoomThirty(),console.log(postThirtyEvent),ajaxCall()}),$("#rooms").on("click",".sixty",function(){var a=$(this).parent().attr("id");console.log("hey this is postlocation: "+a),postSixtyEvent={summary:"Squatting",location:a,start:currentTime.getFullYear()+"-0"+monthNum+"-"+currentTime.getDate()+"T"+currentTime.getHours()+":"+currentTime.getMinutes()+":00-05:00",end:currentTime.getFullYear()+"-0"+monthNum+"-"+currentTime.getDate()+"T"+milSixtyTime+":00-05:00"},bookRoomSixty(),console.log(postSixtyEvent),confirmationSixtyAlert($(this))}),$("#rooms").on("click",".computerStatusIcon",function(){errorAlert($(this))})});var roomArray=[{roomNumber:"CR 2161",capacity:10,computer:!0,available30:!0,available60:!0},{roomNumber:"CR 3212",capacity:36,computer:!0,available30:!0,available60:!0},{roomNumber:"CR 3487",capacity:6,computer:!1,available30:!0,available60:!0},{roomNumber:"CR 4112",capacity:6,computer:!1,available30:!0,available60:!0},{roomNumber:"CR 4141",capacity:6,computer:!1,available30:!0,available60:!0},{roomNumber:"CR 4181",capacity:8,computer:!0,available30:!0,available60:!0},{roomNumber:"CR 4211",capacity:8,computer:!1,available30:!0,available60:!0},{roomNumber:"CR 4245",capacity:4,computer:!1,available30:!0,available60:!0},{roomNumber:"CR 4261",capacity:8,computer:!1,available30:!0,available60:!0},{roomNumber:"CR 4312",capacity:8,computer:!1,available30:!0,available60:!0},{roomNumber:"CR 4416",capacity:8,computer:!1,available30:!0,available60:!0},{roomNumber:"CR 4487",capacity:4,computer:!1,available30:!0,available60:!0},{roomNumber:"CR 4541",capacity:12,computer:!0,available30:!0,available60:!0},{roomNumber:"Boardroom",capacity:36,computer:!0,available30:!0,available60:!0},{roomNumber:"Street Space",capacity:20,computer:!0,available30:!0,available60:!0},{roomNumber:"Training Room",capacity:16,computer:!0,available30:!0,available60:!0}];